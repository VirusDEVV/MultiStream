<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Virus MultiStream </title>
  <link rel="icon" type="image/png" href="https://static.twitchcdn.net/assets/favicon-32-e29e246c157142c94346.png">
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Orbitron:wght@700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>
    :root {
      --main: #9147ff;
      --main2: #00eaff;
      --main3: #23232b;
      --main4: #18181b;
      --accent: #ff4b5c;
      --gold: #ffd700;
      --bg-gradient: linear-gradient(120deg, #23232b 0%, #18181b 100%);
    }
    body {
      font-family: 'Montserrat', Arial, sans-serif;
      margin: 0;
      padding: 0;
      min-height: 100vh;
      background: linear-gradient(120deg, #23232b 0%, #18181b 100%);
      background-size: 200% 200%;
      animation: gradientMove 10s ease-in-out infinite alternate;
      color: #f5f5f7;
      transition: background 0.4s;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }
    .main-layout {
      display: flex;
      flex: 1;
      min-height: 0;
    }
    /* Volet déroulant */
    .aside-toggle {
      position: fixed;
      top: 90px;
      left: 0;
      z-index: 100;
      background: var(--main3);
      color: var(--gold);
      border: none;
      border-radius: 0 16px 16px 0;
      font-size: 2rem;
      padding: 0.5rem 0.7rem;
      cursor: pointer;
      box-shadow: 2px 2px 12px #9147ff33;
      transition: background 0.2s, color 0.2s;
    }
    .aside-toggle:hover {
      background: var(--main2);
      color: #23232b;
    }
    aside {
      width: 320px;
      min-width: 220px;
      background: #1a1a22;
      border-right: 2px solid #23232b;
      padding: 2rem 1rem 1rem 1rem;
      display: flex;
      flex-direction: column;
      gap: 2rem;
      box-shadow: 4px 0 24px #9147ff11;
      z-index: 2;
      position: fixed;
      top: 0;
      left: 0;
      height: 100vh;
      transform: translateX(-100%);
      transition: transform 0.35s cubic-bezier(.77,0,.18,1);
    }
    aside.open {
      transform: translateX(0);
    }
    .fav-category-title {
      font-size: 1.1rem;
      font-weight: bold;
      color: var(--main2);
      margin-bottom: 0.7rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      letter-spacing: 1px;
      font-family: 'Orbitron', 'Montserrat', Arial, sans-serif;
    }
    .favorites-list {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }
    .favorite-pill {
      display: flex;
      align-items: center;
      background: #23232b;
      color: var(--gold);
      border-radius: 16px;
      padding: 0.5rem 1rem;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      border: 1.5px solid #333;
      transition: background 0.2s, border 0.2s, color 0.2s;
      box-shadow: 0 2px 8px #9147ff11;
      user-select: none;
      gap: 0.7rem;
      position: relative;
    }
    .favorite-pill:hover {
      background: var(--main2);
      color: #23232b;
      border: 1.5px solid var(--main);
    }
    .favorite-pill .pill-remove {
      margin-left: auto;
      color: var(--accent);
      font-size: 1.1rem;
      background: none;
      border: none;
      cursor: pointer;
      transition: color 0.2s;
      outline: none;
      padding: 0 0.2rem;
      border-radius: 50%;
    }
    .favorite-pill .pill-remove:hover {
      color: #fff;
      background: var(--accent);
    }
    .favorite-pill .pill-twitch {
      color: var(--main);
      font-size: 1.1rem;
    }
    header {
      background: none;
      color: var(--main);
      padding: 2.5rem 1rem 1.5rem 1rem;
      text-align: center;
      font-size: 2.5rem;
      font-family: 'Orbitron', 'Montserrat', Arial, sans-serif;
      font-weight: 700;
      letter-spacing: 2px;
      border-bottom: 1px solid #333;
      margin-bottom: 1.5rem;
      user-select: none;
      text-shadow: 0 2px 12px #9147ff33;
      position: relative;
      /* Animation néon */
      animation: neon-flicker 2s infinite alternate;
    }
    @keyframes neon-flicker {
      0% { text-shadow: 0 0 24px #9147ff, 0 0 32px #00eaff99; }
      100% { text-shadow: 0 0 48px #9147ff, 0 0 64px #00eaff; }
    }
    .dark-toggle {
      position: absolute;
      top: 24px;
      right: 32px;
      background: none;
      border: none;
      color: var(--main2);
      font-size: 2rem;
      cursor: pointer;
      transition: color 0.2s, transform 0.15s;
    }
    .dark-toggle:hover {
      color: var(--main);
      transform: scale(1.1) rotate(-8deg);
    }
    .content {
      flex: 1;
      display: flex;
      flex-direction: column;
      min-width: 0;
      margin-left: 0;
      transition: margin-left 0.35s cubic-bezier(.77,0,.18,1);
    }
    .content.shifted {
      margin-left: 320px;
    }
    #controls {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 1rem;
      background: none;
      margin-bottom: 1.5rem;
      flex-wrap: wrap;
    }
    #streamerInput {
      padding: 0.9rem 1.2rem;
      font-size: 1.1rem;
      border: 1.5px solid #333;
      border-radius: 12px;
      background: #18181b;
      color: #fff;
      outline: none;
      width: 220px;
      transition: border 0.2s, box-shadow 0.2s;
    }
    #streamerInput:focus {
      border: 1.5px solid var(--main2);
      box-shadow: 0 2px 16px #00eaff33;
    }
    .btn, .clear-btn {
      padding: 0.9rem 1.3rem;
      font-size: 1.1rem;
      border: none;
      border-radius: 12px;
      background: var(--main);
      color: #fff;
      cursor: pointer;
      font-weight: 600;
      letter-spacing: 1px;
      transition: background 0.2s, transform 0.1s;
    }
    .btn:hover, .clear-btn:hover {
      background: var(--main2);
      color: #23232b;
      transform: scale(1.07);
    }
    .fav-btn {
      background: none;
      border: none;
      color: var(--gold);
      font-size: 1.7rem;
      cursor: pointer;
      margin-left: 0.2rem;
      transition: color 0.2s, transform 0.15s;
      outline: none;
    }
    .fav-btn.faved {
      color: var(--gold);
      transform: scale(1.15) rotate(-8deg);
    }
    .fav-btn:hover {
      color: var(--main2);
    }
    #streams {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(420px, 1fr));
      gap: 32px;
      padding: 2rem 2vw;
      max-width: 1400px;
      margin: auto;
    }
    .stream-container {
      background: #18181b;
      border-radius: 18px;
      box-shadow: 0 4px 24px #9147ff22;
      padding: 1.2rem 1rem 1.5rem 1rem;
      display: flex;
      flex-direction: column;
      align-items: stretch;
      border: 1.5px solid #23232b;
      transition: box-shadow 0.2s, border 0.2s, transform 0.2s;
    }
    .stream-container:hover {
      box-shadow: 0 8px 32px #00eaff44;
      border: 1.5px solid var(--main2);
      transform: translateY(-4px) scale(1.02);
    }
    .stream-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 0.7rem;
    }
    .stream-title {
      font-size: 1.2rem;
      font-weight: bold;
      color: #fff;
      letter-spacing: 1px;
      text-transform: capitalize;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-family: 'Orbitron', 'Montserrat', Arial, sans-serif;
    }
    .stream-fav-btn {
      background: none;
      border: none;
      color: var(--gold);
      font-size: 1.2rem;
      cursor: pointer;
      margin-left: 0.2rem;
      transition: color 0.2s, transform 0.15s;
      outline: none;
      padding: 0;
    }
    .stream-fav-btn.faved {
      color: var(--gold);
      transform: scale(1.1) rotate(-8deg);
    }
    .stream-fav-btn:hover {
      color: var(--main2);
    }
    .remove-btn {
      background: var(--accent);
      color: #fff;
      border: none;
      border-radius: 8px;
      padding: 0.4rem 1rem;
      font-size: 1rem;
      cursor: pointer;
      font-weight: bold;
      transition: background 0.2s, transform 0.1s;
      box-shadow: 0 2px 8px #ff4b5c22;
      letter-spacing: 1px;
    }
    .remove-btn:hover {
      background: #ff1a40;
      color: #fff;
      transform: scale(1.08);
    }
    .stream-player {
      width: 100%;
      aspect-ratio: 16/9;
      min-height: 320px;
      max-height: 70vh;
      border: none;
      border-radius: 12px;
      margin-bottom: 0.5rem;
      box-shadow: 0 2px 16px #9147ff22;
      background: none;
    }
    .feedback-msg {
      position: fixed;
      top: 18px;
      left: 50%;
      transform: translateX(-50%);
      background: #23232b;
      color: var(--main2);
      padding: 0.7rem 1.7rem;
      border-radius: 12px;
      font-size: 1rem;
      font-weight: bold;
      box-shadow: 0 4px 24px #00eaff33;
      z-index: 9999;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s;
    }
    .feedback-msg.show {
      opacity: 1;
      pointer-events: auto;
    }
    .feedback-msg.error {
      color: var(--accent);
      background: #2b1818;
      box-shadow: 0 4px 24px #ff4b5c33;
    }
    footer {
      background: none;
      color: #888;
      text-align: center;
      padding: 1.2rem 0 0.7rem 0;
      font-size: 1rem;
      letter-spacing: 1px;
      margin-top: 2.5rem;
      font-family: 'Montserrat', Arial, sans-serif;
    }
    @media (max-width: 900px) {
      .main-layout {
        flex-direction: column;
      }
      aside {
        width: 100%;
        min-width: 0;
        border-right: none;
        border-bottom: 2px solid #23232b;
        flex-direction: row;
        gap: 1.5rem;
        overflow-x: auto;
        padding: 1rem 0.5rem;
        height: auto;
        position: static;
        transform: none !important;
      }
      .content.shifted {
        margin-left: 0;
      }
      .aside-toggle {
        top: 70px;
      }
    }
    @media (max-width: 700px) {
      #controls {
        flex-direction: column;
        align-items: stretch;
        gap: 0.7rem;
        padding: 0.7rem 0.5rem;
      }
      #streams {
        grid-template-columns: 1fr;
        padding: 1rem 0.5rem;
      }
      .stream-player {
        min-height: 180px;
      }
    }
    body.dark-mode {
      background: linear-gradient(120deg, #18181b 0%, #23232b 100%);
      color: #e0e0e0;
    }
    body.dark-mode aside {
      background: #18181b;
      border-color: #23232b;
    }
    body.dark-mode .favorite-pill {
      background: #23232b;
      color: var(--gold);
      border: 1.5px solid #333;
    }
    body.dark-mode .favorite-pill:hover {
      background: var(--main2);
      color: #23232b;
      border: 1.5px solid var(--main);
    }
    body.dark-mode .stream-container {
      background: #23232b;
      box-shadow: 0 8px 32px #00eaff22;
    }
    body.dark-mode .btn, body.dark-mode .clear-btn {
      background: var(--main2);
      color: #23232b;
    }
    body.dark-mode .btn:hover, body.dark-mode .clear-btn:hover {
      background: var(--main);
      color: #fff;
    }
    .animated-bg {
      position: fixed;
      inset: 0;
      z-index: 0;
      pointer-events: none;
      width: 100vw;
      height: 100vh;
      background:
        radial-gradient(ellipse 40% 30% at 20% 30%, #9147ff44 0%, transparent 80%),
        radial-gradient(ellipse 35% 25% at 80% 70%, #00eaff33 0%, transparent 80%);
      animation: bgMove 12s ease-in-out infinite alternate;
    }
    @keyframes bgMove {
      0% { background-position: 20% 30%, 80% 70%; }
      100% { background-position: 30% 40%, 70% 60%; }
    }
  </style>
</head>
<body>
  <div class="animated-bg"></div>
  <button class="aside-toggle" id="asideToggle" title="Afficher les favoris"><i class="fa-solid fa-star"></i></button>
  <button class="dark-toggle" id="darkToggle" title="Basculer le mode sombre"><i class="fa-solid fa-moon"></i></button>
  <header>
    <i class="fa-brands fa-twitch" style="color:#9147ff;margin-right:0.7rem;font-size:2.2rem;"></i>
    <span id="animatedTitle">Virus MultiStream</span>
  </header>
  <div class="main-layout">
    <aside id="favorites-aside">
      <!-- Les favoris seront générés ici -->
    </aside>
    <div class="content" id="mainContent">
      <div id="controls">
        <input type="text" id="streamerInput" placeholder="Nom du streamer Twitch" autocomplete="off" autofocus>
        <button class="btn" onclick="addStreamer()"><i class="fa-solid fa-plus"></i> Ajouter</button>
        <button class="clear-btn" onclick="clearAll()"><i class="fa-solid fa-trash"></i> Tout supprimer</button>
        <button class="fav-btn" id="favBtn" title="Ajouter aux favoris"><i class="fa-regular fa-star"></i></button>
      </div>
      <div id="streams">
        <div id="welcome" style="display:flex;flex-direction:column;align-items:center;justify-content:center;height:60vh;opacity:0.85;">
          <div style="font-size:2.2rem;font-family:'Orbitron',sans-serif;color:#9147ff;text-shadow:0 0 24px #9147ff88;animation:fadeInUp 1.2s;">
            👋 Bienvenue sur <span style="color:#00eaff;">Virus MultiStream</span> !
          </div>
          <div style="margin:1.5rem 0 1rem 0;font-size:1.2rem;color:#fff;max-width:500px;text-align:center;">
            Ajoute tes streamers favoris à gauche ou découvre des chaînes populaires en cliquant sur les boutons ci-dessous.:
          </div>
          <div style="display:flex;gap:1rem;">
            <button onclick="addStreamer('TwincyTV')" style="background:#9147ff;color:#fff;border:none;border-radius:12px;padding:0.7rem 1.3rem;font-size:1.1rem;cursor:pointer;box-shadow:0 2px 12px #9147ff33;">🎮 TwincyTV</button>
            <button onclick="addStreamer('Aenot')" style="background:#00eaff;color:#23232b;border:none;border-radius:12px;padding:0.7rem 1.3rem;font-size:1.1rem;cursor:pointer;box-shadow:0 2px 12px #00eaff33;">⚡ Aenot</button>
            <button onclick="addStreamer('Khadim')" style="background:#474aff;color:#fff;border:none;border-radius:12px;padding:0.7rem 1.3rem;font-size:1.1rem;cursor:pointer;box-shadow:0 2px 12px #9147ff33;">🎮 Khadim</button>
            <button onclick="addStreamer('JLTomy')" style="background:#ffd700;color:#23232b;border:none;border-radius:12px;padding:0.7rem 1.3rem;font-size:1.1rem;cursor:pointer;box-shadow:0 2px 12px #ffd70033;">⭐ JLTomy</button>
          </div>
        </div>
      </div>
    </div>
  </div>
  <footer>
    <span><i class="fa-solid fa-heart" style="color:#ff4b5c;"></i> VirusDEV &copy; 2025 — <span style="color:#00eaff">Création stylée pour la commu Twitch !</span></span>
  </footer>
  <div id="feedbackMsg" class="feedback-msg"></div>
  <!-- Petit badge Discord flottant en bas à droite -->
  <div id="discord-badge"
       style="position:fixed;bottom:24px;right:24px;z-index:9999;display:flex;align-items:center;gap:0.5rem;background:#23232bcc;color:#fff;padding:0.5rem 1rem;border-radius:16px;box-shadow:0 2px 12px #7289da44;font-size:1rem;">
    <i class="fa-brands fa-discord" style="color:#7289da;font-size:1.5rem;"></i>
    <span id="discordTagSmall" style="font-weight:bold;letter-spacing:1px;">Virus</span>
    <a href="https://discord.gg/TONINVITATION" target="_blank"
       style="background:#7289da;color:#fff;border:none;border-radius:8px;padding:0.3rem 0.7rem;font-size:0.95rem;cursor:pointer;text-decoration:none;display:flex;align-items:center;gap:0.3rem;">
      <i class="fa-brands fa-discord"></i> Serveur
    </a>
  </div>
  <script>
    const parent = location.hostname;

    // Catégorie unique
    const FAVORITE_CATEGORIES = [
      { name: "Streamers FR 🇫🇷", emoji: "🇫🇷", key: "fr" }
    ];

    // Structure des favoris : { streamer, category }
    // Fonction pour gérer les favoris dans le localStorage
    function getFavorites() {
      return JSON.parse(localStorage.getItem('twitchFavoritesV2') || '[]');
    }
    function setFavorites(favs) {
      localStorage.setItem('twitchFavoritesV2', JSON.stringify(favs));
    }

    function renderFavorites() {
      const aside = document.getElementById('favorites-aside');
      aside.innerHTML = '';

      const favs = getFavorites();

      // Récupère les infos de tous les favoris en parallèle
      Promise.all(favs.map(async fav => {
        const info = await getTwitchUserInfo(fav.streamer);
        return { ...fav, info };
      })).then(favsWithInfo => {
        // Sépare en ligne et hors ligne
        const onlineFavs = favsWithInfo.filter(f => f.info && f.info.isLive);
        const offlineFavs = favsWithInfo.filter(f => !f.info || !f.info.isLive);

        // Bloc EN LIGNE
        const onlineDiv = document.createElement('div');
        onlineDiv.className = 'fav-category';
        onlineDiv.innerHTML = `<div class="fav-category-title" style="color:#43ff43;">🟢 En ligne</div>`;
        const onlineList = document.createElement('div');
        onlineList.className = 'favorites-list';
        if (onlineFavs.length === 0) {
          onlineList.innerHTML = `<span style="color:#888;font-size:1rem;">Aucun favori en ligne</span>`;
        } else {
          onlineFavs.forEach(fav => {
            const pill = document.createElement('div');
            pill.className = 'favorite-pill';
            pill.title = `Afficher ${fav.streamer}`;
            const info = fav.info;
            pill.innerHTML = `
              <span style="display:flex;align-items:center;gap:0.5rem;">
                <img src="${info?.avatar || 'https://static.twitchcdn.net/assets/favicon-32-e29e246c157142c94346.png'}" alt="" style="width:24px;height:24px;border-radius:50%;border:2px solid #43ff43;">
                <span class="pill-name">${info?.displayName || fav.streamer}</span>
                <span style="width:10px;height:10px;border-radius:50%;background:#43ff43;display:inline-block;margin-left:6px;" title="En ligne"></span>
              </span>
              <button class="pill-remove" title="Retirer des favoris" onclick="removeFavorite('${fav.streamer}');event.stopPropagation();"><i class="fa-solid fa-xmark"></i></button>
            `;
            pill.onclick = () => addStreamer(fav.streamer);
            onlineList.appendChild(pill);
          });
        }
        onlineDiv.appendChild(onlineList);
        aside.appendChild(onlineDiv);

        // Bloc HORS LIGNE
        const offlineDiv = document.createElement('div');
        offlineDiv.className = 'fav-category';
        offlineDiv.innerHTML = `<div class="fav-category-title" style="color:#ff4b5c;">🔴 Hors ligne</div>`;
        const offlineList = document.createElement('div');
        offlineList.className = 'favorites-list';
        if (offlineFavs.length === 0) {
          offlineList.innerHTML = `<span style="color:#888;font-size:1rem;">Aucun favori hors ligne</span>`;
        } else {
          offlineFavs.forEach(fav => {
            const pill = document.createElement('div');
            pill.className = 'favorite-pill';
            pill.title = `Afficher ${fav.streamer}`;
            const info = fav.info;
            pill.innerHTML = `
              <span style="display:flex;align-items:center;gap:0.5rem;">
                <img src="${info?.avatar || 'https://static.twitchcdn.net/assets/favicon-32-e29e246c157142c94346.png'}" alt="" style="width:24px;height:24px;border-radius:50%;border:2px solid #ff4b5c;">
                <span class="pill-name">${info?.displayName || fav.streamer}</span>
                <span style="width:10px;height:10px;border-radius:50%;background:#ff4b5c;display:inline-block;margin-left:6px;" title="Hors ligne"></span>
              </span>
              <button class="pill-remove" title="Retirer des favoris" onclick="removeFavorite('${fav.streamer}');event.stopPropagation();"><i class="fa-solid fa-xmark"></i></button>
            `;
            pill.onclick = () => addStreamer(fav.streamer);
            offlineList.appendChild(pill);
          });
        }
        offlineDiv.appendChild(offlineList);
        aside.appendChild(offlineDiv);
      });
    }

    function addToFavorites() {
      const input = document.getElementById('streamerInput');
      const streamer = input.value.trim().toLowerCase();
      if (!streamer) return;
      let favs = getFavorites();
      let catKey = "fr";
      if (!favs.some(f => f.streamer === streamer)) {
        favs.push({ streamer, category: catKey });
        setFavorites(favs);
        renderFavorites();
        updateFavBtn();
        showFeedback('Ajouté aux favoris !');
      } else {
        showFeedback('Déjà dans les favoris', true);
      }
    }

    function removeFavorite(streamer) {
      let favs = getFavorites();
      favs = favs.filter(fav => fav.streamer !== streamer);
      setFavorites(favs);
      renderFavorites();
      updateFavBtn();
      showFeedback('Retiré des favoris');
      const favBtn = document.querySelector(`#stream-${streamer} .stream-fav-btn`);
      if (favBtn) {
        favBtn.classList.remove('faved');
        favBtn.innerHTML = '<i class="fa-regular fa-star"></i>';
      }
    }

    function updateFavBtn() {
      const input = document.getElementById('streamerInput');
      const favBtn = document.getElementById('favBtn');
      const streamer = input.value.trim().toLowerCase();
      let favs = getFavorites();
      if (streamer && favs.some(f => f.streamer === streamer)) {
        favBtn.classList.add('faved');
        favBtn.innerHTML = '<i class="fa-solid fa-star"></i>';
      } else {
        favBtn.classList.remove('faved');
        favBtn.innerHTML = '<i class="fa-regular fa-star"></i>';
      }
    }

    function showFeedback(msg, isError = false) {
      const feedback = document.getElementById('feedbackMsg');
      feedback.textContent = msg;
      feedback.className = 'feedback-msg' + (isError ? ' error' : '');
      feedback.classList.add('show');
      setTimeout(() => {
        feedback.classList.remove('show');
      }, 1800);
    }

    function showError(msg) {
      showFeedback(msg, true);
    }

    function addStreamer(streamerName) {
      const input = document.getElementById('streamerInput');
      const streamer = (streamerName || input.value).trim().toLowerCase();
      if (streamer) {
        if (document.getElementById('stream-' + streamer)) {
          showError('Ce streamer est déjà affiché !');
          input.value = '';
          return;
        }
        const container = document.createElement('div');
        container.className = 'stream-container';
        container.id = 'stream-' + streamer;
        container.innerHTML = `
          <div class="stream-header">
            <span class="stream-title">${streamer}
              <button class="stream-fav-btn${getFavorites().some(f => f.streamer === streamer) ? ' faved' : ''}" title="Ajouter/Retirer des favoris" onclick="toggleFavorite('${streamer}');event.stopPropagation();">
                <i class="fa${getFavorites().some(f => f.streamer === streamer) ? 's' : 'r'} fa-star"></i>
              </button>
            </span>
            <button class="remove-btn" onclick="removeStreamer('${streamer}')"><i class="fa-solid fa-xmark"></i></button>
          </div>
          <iframe
            class="stream-player"
            src="https://player.twitch.tv/?channel=${streamer}&parent=${parent}"
            allowfullscreen>
          </iframe>
        `;
        document.getElementById('streams').appendChild(container);
        input.value = '';
        input.focus();
        showFeedback('Stream ajouté !');
        const welcome = document.getElementById('welcome');
        if (welcome) welcome.style.display = 'none';
      }
    }

    function removeStreamer(streamer) {
      const el = document.getElementById('stream-' + streamer);
      if (el) {
        el.remove();
        showFeedback('Stream supprimé');
      }
    }

    function clearAll() {
      document.getElementById('streams').innerHTML = '';
      showFeedback('Tous les streams ont été supprimés');
    }

    function toggleFavorite(streamer) {
      let favs = getFavorites();
      if (favs.some(f => f.streamer === streamer)) {
        favs = favs.filter(fav => fav.streamer !== streamer);
        showFeedback('Retiré des favoris');
      } else {
        let catKey = "fr";
        favs.push({ streamer, category: catKey });
        showFeedback('Ajouté aux favoris !');
      }
      setFavorites(favs);
      renderFavorites();
      updateFavBtn();
      const favBtn = document.querySelector(`#stream-${streamer} .stream-fav-btn`);
      if (favBtn) {
        if (favs.some(f => f.streamer === streamer)) {
          favBtn.classList.add('faved');
          favBtn.innerHTML = '<i class="fa-solid fa-star"></i>';
        } else {
          favBtn.classList.remove('faved');
          favBtn.innerHTML = '<i class="fa-regular fa-star"></i>';
        }
      }
    }

    // À placer en haut de ton script
    const TWITCH_CLIENT_ID = 'gp762nuuoqcoxypju8c569th9wz7q5';
    const TWITCH_ACCESS_TOKEN = 'rndlkr12hpgft5wa7yg7qvehd1ymcv';

    // Récupère les infos d'un streamer (avatar, statut, etc.)
    async function getTwitchUserInfo(username) {
      const userRes = await fetch(`https://api.twitch.tv/helix/users?login=${username}`, {
        headers: {
          'Client-ID': TWITCH_CLIENT_ID,
          'Authorization': `Bearer ${TWITCH_ACCESS_TOKEN}`
        }
      });
      const userData = await userRes.json();
      if (!userData.data || !userData.data[0]) return null;
      const user = userData.data[0];

      // Vérifie si le streamer est en live
      const streamRes = await fetch(`https://api.twitch.tv/helix/streams?user_id=${user.id}`, {
        headers: {
          'Client-ID': TWITCH_CLIENT_ID,
          'Authorization': `Bearer ${TWITCH_ACCESS_TOKEN}`
        }
      });
      const streamData = await streamRes.json();
      const isLive = streamData.data && streamData.data.length > 0;
      const streamInfo = isLive ? streamData.data[0] : null;

      return {
        avatar: user.profile_image_url,
        displayName: user.display_name,
        isLive,
        title: streamInfo ? streamInfo.title : '',
        game: streamInfo ? streamInfo.game_name : '',
        viewers: streamInfo ? streamInfo.viewer_count : 0
      };
    }

    // Ajout avec la touche Entrée
    document.getElementById('streamerInput').addEventListener('keydown', function(e) {
      if (e.key === 'Enter') addStreamer();
      setTimeout(updateFavBtn, 10);
    });

    document.getElementById('streamerInput').addEventListener('input', updateFavBtn);
    document.getElementById('favBtn').addEventListener('click', addToFavorites);

    // Volet déroulant
    const aside = document.getElementById('favorites-aside');
    const asideToggle = document.getElementById('asideToggle');
    const mainContent = document.getElementById('mainContent');
    let asideOpen = false;
    asideToggle.addEventListener('click', () => {
      asideOpen = !asideOpen;
      aside.classList.toggle('open', asideOpen);
      mainContent.classList.toggle('shifted', asideOpen);
      asideToggle.title = asideOpen ? "Cacher les favoris" : "Afficher les favoris";
      asideToggle.innerHTML = asideOpen ? '<i class="fa-solid fa-chevron-left"></i>' : '<i class="fa-solid fa-star"></i>';
    });

    // Dark mode toggle
    document.getElementById('darkToggle').addEventListener('click', function() {
      document.body.classList.toggle('dark-mode');
      this.innerHTML = document.body.classList.contains('dark-mode')
        ? '<i class="fa-solid fa-sun"></i>'
        : '<i class="fa-solid fa-moon"></i>';
      localStorage.setItem('darkMode', document.body.classList.contains('dark-mode') ? '1' : '0');
    });

    // Appliquer dark mode au chargement si activé
    window.onload = () => {
      document.getElementById('streamerInput').focus();
      renderFavorites();
      updateFavBtn();
      if (localStorage.getItem('darkMode') === '1') {
        document.body.classList.add('dark-mode');
        document.getElementById('darkToggle').innerHTML = '<i class="fa-solid fa-sun"></i>';
      }
    };

    // Pour accès depuis HTML
    window.addStreamer = addStreamer;
    window.removeStreamer = removeStreamer;
    window.clearAll = clearAll;
    window.removeFavorite = removeFavorite;
    window.toggleFavorite = toggleFavorite;

    function openAndCopyDiscord() {
      const tag = document.getElementById('discordTag').innerText;
      window.open('https://discord.com/app', '_blank');
      navigator.clipboard.writeText(tag).then(() => {
        const copied = document.getElementById('discordCopied');
        copied.style.display = 'block';
        setTimeout(() => copied.style.display = 'none', 1500);
      });
    }
  </script>
</body>
</html>

